{% extends "internal/base.html" %}
{% load static %}
{% block title %}Manage Members{% endblock %}


{% block content %}

<h2>Manage Members</h2>
<p class="section-subtitle">
    Collection: <strong>{{ collection.name }}</strong>
</p>

<!-- ================= ADD MEMBER ================= -->
<div class="card" style="max-width:480px; margin-bottom:25px;">
    <h3>Add / Update Member</h3>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_member">

        <p>
            <label>Username:</label>
            <input type="text" name="username" class="form-control" required>
        </p>

        <p>
            <label>Role:</label>
            <select name="role" class="form-control">
                <option value="viewer">Viewer</option>
                <option value="editor">Editor</option>
                <option value="owner">Owner</option>
            </select>
        </p>

        <button class="btn-primary" type="submit">
            Save Member
        </button>
    </form>
</div>

<!-- ================= MEMBER LIST ================= -->
<div class="card">
    <h3>Current Members</h3>

    {% if members %}
        <table class="table">
            <tr>
                <th align="left">User</th>
                <th align="left">Role</th>
                <th></th>
            </tr>

            {% for m in members %}
            <tr>
                <td>{{ m.user.username }}</td>
                <td>{{ m.role }}</td>
                <td style="text-align:right;">

                    {# Não permitir remover a si mesmo #}
                    {% if m.user != request.user %}
                        <form method="post" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="remove_member">
                            <input type="hidden" name="role_id" value="{{ m.id }}">
                            <button class="btn btn-danger btn-sm">
                                Remove
                            </button>
                        </form>
                    {% else %}
                        <span class="section-subtitle">You</span>
                    {% endif %}

                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p class="section-subtitle">No members yet.</p>
    {% endif %}
</div>

<a href="/?page=collections" class="btn btn-outline-secondary" style="margin-top:20px;">
    ← Back to Collections
</a>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/collection_members.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'core/js/collection_members.js' %}"></script>
{% endblock %}

